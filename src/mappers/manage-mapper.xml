<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="manageMapper">

	<resultMap id="manageResultSet" type="Manage" >
		
		<id property="idx" column="IDX"/>
		<result property="yyyy" column="YYYY"/>
		<result property="mm" column="MM"/>
		<result property="wdt" column="WDT"/>
		<result property="edt" column="EDT"/>
		<result property="uId" column="U_ID"/>
		<result property="gasM" column="GAS_M"/>
		<result property="elM" column="EL_M"/>
		<result property="wtM" column="WT_M"/>
		<result property="itM" column="IT_M"/>
		
		<result property="gNum" column="G_NUM"/>
		<result property="defM" column="DEF_M"/>
		<result property="cGm" column="C_GM"/>
		<result property="uGm" column="U_GM"/>
		<result property="aGm" column="A_GM"/>
		<result property="sGm" column="S_GM"/>
		<result property="mGm" column="M_GM"/>
		<result property="avgGm" column="AVG_GM"/>
		<result property="jsGm" column="JS_GM"/>
		<result property="enGu" column="EN_GU"/>
		<result property="monGu" column="MON_GU"/>
		<result property="useG" column="USE_G"/>
		<result property="useB" column="USE_B"/>
		<result property="gChk" column="G_CHK"/>
		<result property="autoM" column="AUTO_M"/>
		<result property="autoHow" column="AUTO_HOW"/>
		<result property="autoWhen" column="AUTO_WHEN"/>
		
	</resultMap>



	<!--기본 공과금 데이터 시작 -->

	<!-- 공과금 전체 페이지 당월 데이터 -->
	<select id="manageList" parameterType="Manage" resultMap="manageResultSet">
		SELECT IDX, YYYY,MM,U_ID, GAS_M, EL_M, WT_M, IT_M
		FROM MANAGE_MA WHERE U_ID= #{uId} AND YYYY =#{yyyy} AND MM = #{mm}	
	</select>

	<!-- 공과금 전체 페이지 당월,전월 비교 데이터 -->
	<select id="manageNP" parameterType="Manage" resultMap="manageResultSet">
		SELECT IDX, YYYY,MM,U_ID, NVL(GAS_M,0) as GAS_M, NVL(EL_M,0) AS EL_M , NVL(WT_M,0) AS WT_M, NVL(IT_M,0) AS IT_M
		FROM MANAGE_MA WHERE U_ID= #{uId} AND (YYYY =#{yyyy} AND MM = #{mm} or YYYY =#{yyyy2} AND MM = #{mm2}) 	
	</select>
	
	<!-- 공과금 전체 페이지 3개월 비교 데이터 -->
	<select id="manageListP3" parameterType="Manage" resultMap="manageResultSet">
		SELECT IDX, YYYY,MM,U_ID, NVL(GAS_M,0) as GAS_M, NVL(EL_M,0) AS EL_M , NVL(WT_M,0) AS WT_M, NVL(IT_M,0) AS IT_M
		FROM MANAGE_MA WHERE U_ID= #{uId} AND (YYYY =#{yyyy} AND MM = #{mm} or YYYY =#{yyyy2} AND MM = #{mm2} or YYYY =#{yyyy3} AND MM = #{mm3}) 	
	</select>
	
	<!-- 공과금 데이터 insert(당월) -->
	<insert id="insertMAll" parameterType="Manage">
		INSERT INTO MANAGE_MA VALUES(MN_SEQ.NEXTVAL,#{yyyy}, #{mm}, SYSDATE, SYSDATE, #{uId}, 
		#{gasM},#{elM},#{wtM},#{itM})
	</insert>

	<!-- 공과금 데이터 update (기본값만) -->
	<update id="updateMAll" parameterType="Manage">
		UPDATE MANAGE_MA SET EDT=SYSDATE, GAS_M=#{gasM}, EL_M=#{elM}, WT_M=#{wtM}, IT_M=#{itM}
		WHERE U_ID=#{uId} AND YYYY=#{yyyy} AND MM=#{mm}
	</update>
	
	<!-- 공과금 가스 상세 데이터 insert(당월) -->
	<insert id="insertMGAS" parameterType="Manage">
		INSERT INTO MANAGE_GAS(IDX,JIDX,U_ID) VALUES (MG_SEQ.NEXTVAL,#{jidx}, #{uId})
	</insert>
	
	<!-- 공과금 상세(가스,수도...) 데이터 가져올 때 필요한 기본 공과금 데이터 IDX -->
	<select id="manageIndex" parameterType="Manage" resultType="_int">
			SELECT IDX
		FROM MANAGE_MA WHERE U_ID= #{uId} AND YYYY =#{yyyy} AND MM = #{mm}	
	</select>
	
	<!--기본 공과금 데이터 종료 -->
	
	<!--가스 상세 데이터 시작 -->
	
	<!-- 가스 상세 데이터 가져오기 (당월분 1) -->
	<select id="manageGasNow" parameterType="Manage" resultMap="manageResultSet">
		SELECT * FROM MANAGE_GAS A
		LEFT JOIN MANAGE_MA B ON A.JIDX=B.IDX
		WHERE A.U_ID=#{uId} AND B.YYYY=#{yyyy} AND B.MM=#{mm}  	
	</select>
	
	
	<!-- 공과금 데이터 update (기본값만) -->
	<update id="updateGas" parameterType="Manage">
		UPDATE MANAGE_GAS SET EDT=SYSDATE, DEF_M=#{defM}, C_GM=#{cGm}, U_GM=#{uGm}, A_GM=#{aGm}
		, S_GM=#{sGm}, M_GM=#{mGm}, AVG_GM=#{avgGm}, JS_GM=#{jsGm}, EN_GU=#{enGu}, MON_GU=#{monGu}
		, USE_G=#{useG}, USE_B=#{useB}
		WHERE U_ID=#{uId} AND IDX=#{idx}
	</update>
	
	<!-- 공과금 기본 가스 데이터 update -->
	<update id="updateMGas" parameterType="Manage">
		UPDATE MANAGE_MA SET GAS_M=${defM} + ${cGm} +${uGm} +${aGm} +${sGm} +${mGm} + ${avgGm} +  ${jsGm} +${enGu}
		WHERE U_ID=#{uId} AND IDX=#{jidx}
	</update>
	
	<!--가스 상세 데이터 종료-->
</mapper>
